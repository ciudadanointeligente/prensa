---
layout: default
---
<div id="news">

	<div class="select text-center">
		<p>Recopilación de artículos de prensa (nacional e internacional) donde se menciona el trabajo de la fundación Ciudadano Inteligente</p>
		<select onchange="get_news(this.value)" class="form-control">
			<option value="" disabled selected>Selecciona una fecha</option>
			{% for period in site.periods %}
				{% for y in period.years %}
				<optgroup label="{{ y.year }}">
					{% for s in y.sheets %}
					<option value="{{ y.year }}-{{ s.month }}">{{ s.month }}</option>
					{% endfor %}
				</optgroup>
				{% endfor %}
			{% endfor %}
		</select>
	</div>

	<div id="articles"></div>

	<div id="spin" class="text-center">
		<i class="fa fa-spinner fa-spin fa-4x hidden"></i>
	</div>

</div>


<script type="text/javascript">

  function get_news(filter_date) {
  	var year = filter_date.split("-")[0];
  	var month = filter_date.split("-")[1];

  	spin(true);

	{% for y in site.periods[0].years %}
	  if ( '{{y.year}}' == year ) {
		{% for s in y.sheets %}
		  if ( '{{s.month}}' == month ) {
			var url = '//script.google.com/macros/s/AKfycbw8T0PhIuD9NqpH0nOpU32P6ypDjwqvqs-p3nuu67UXCHU8E5qo/exec' + '?id=1AWDMIZsE9k3jQaJlgCKBt8vwVHg4Tg4MqHd-09CRc6I' + '&sheet={{s.sheet}}'
			draw_news(url, '{{y.year}}', '{{s.month}}', '{{s.sheet}}');
		  }
		{% endfor %}
	  }
	{% endfor %}
  }

  function spin(status) {
  	var classes = 'fa fa-spinner fa-spin fa-4x'
  	var spin = document.getElementById('spin');
  		spin.children[0].className = classes+' hidden';
  	if(status)
  		spin.children[0].className = classes;
  }

  function draw_news(url, year, month, sheet) {
	// var div = $('#year-'+year+' #month-'+month)
	var div = $('#articles')
	//clean
	div.empty();
	$.getJSON( url, function( data ) {
	  html = '<div class="page-header"><h4>'+month.toUpperCase()+' / '+year+'</h4></div>'
	  html += '<div class="row">';
	  var cnt = 1;
	  $.each(data[sheet], function(key, value){
		if(value.titular) {
			html += '<div class="col-md-4 '+sheet+'">';
			html += '<div class="article-news">';
			// html += '<h3>'+year+' - '+month+'</h3>';
			html += '<ul class="list-inline">';
			html += '<li><span class="label label-success">'+value.medio+'</span></li>';
			html += '<li><small>'+value.fecha+'</small></li>';
			html += '</ul>';
			html += '<h4>'+value.titular+'</h4>';
			html += '<p>'+value.tema+'</p>';
			html += '<p><a href="'+value.link+'" target="_blank">leer</a></p>';
			html += '</div>';
			html += '</div>';
			if( cnt%3==0 )
			  html += '</div><div class="row">';
			cnt++;
		}
	  })
	  html += '</div>';
	  div.prepend(html);// = html
	  spin(false);
	})
  };


  document.addEventListener('DOMContentLoaded', function(){ 
	var d = new Date();
	var months = new Array('enero', 'febrero', 'marzo', 'abril', 'mayo', 'junio', 'julio', 'agosto', 'septiembre', 'octubre', 'noviembre', 'diciembre');

	var year = d.getFullYear();
	var month = months[d.getMonth()]; 
	var sheet = month+"_"+year;
	var url = '//script.google.com/macros/s/AKfycbw8T0PhIuD9NqpH0nOpU32P6ypDjwqvqs-p3nuu67UXCHU8E5qo/exec' + '?id=1AWDMIZsE9k3jQaJlgCKBt8vwVHg4Tg4MqHd-09CRc6I' + '&sheet='+sheet;
	draw_news(url, year, month, sheet);
  }, false);

</script>
